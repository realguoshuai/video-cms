<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zhiyou100.dao.VideoDao">
	<select id="listObject" resultType="videoDO">
		SELECT
		v.name
		,v.course_id
		,v.speaker_id
		,c.subject_id
		,v.length
		FROM video v
		left join
		course c on c.id=v.course_id
		left join 
		subject s    on s.id=c.subject_id;
	</select>
	
	<select id="listObjectByQuery" resultType="videoDO">
			SELECT
		v.name
		,v.course_id
		,v.speaker_id
		,c.subject_id
		,v.length
		FROM video v
		left join
		course c on c.id=v.course_id
		left join 
		subject s  on s.id=c.subject_id
		<where>
			<if test="keywords != null">
				<foreach collection="keywords" item="item">
					OR v.name LIKE
					'%${item}%'
				</foreach>
			</if>
			<if test="status==0">
				AND v.status=0
			</if>
			<if test="status==1">
				AND v.status=1
			</if>
		</where>
		<if test="sort != null and order != null">
			ORDER BY ${sort} ${order}
		</if>
		<if test="offset != null and limit != null">
			LIMIT ${offset}, ${limit}
		</if>
	</select>

	<select id="countObjectByQuery" resultType="int">
	SELECT
		v.name
		,v.course_id
		,v.speaker_id
		,c.subject_id
		,v.length
		FROM video v
		left join
		course c on c.id=v.course_id
		left join 
		subject s  on s.id=c.subject_id
		<where>
			<if test="keywords != null">
				<foreach collection="keywords" item="item">
					OR v.name LIKE
					'%${item}%'
				</foreach>
			</if>
			<if test="status==0">
				AND status=0
			</if>
			<if test="status==1">
				AND status=1
			</if>
		</where>
		<if test="sort != null and order != null">
			ORDER BY ${sort} ${order}
		</if>
		<if test="offset != null and limit != null">
			LIMIT ${offset}, ${limit}
		</if>
		)a
	</select>

 <insert id="insertObject">
		insert into video
		(`name`,`speaker_id`,`course_id`,`cover_url`,`video_url`,`describe`)
		values
		(#{name},${speakerId},${courseId},#{coverUrl},#{videoUrl},#{describe})

	</insert>

	<update id="updateObject">
		update video
		set
		`name`=#{name},
		`speaker_id`=${speakerId},
		`course_id`=${courseId},
		`cover_url`=#{coverUrl},
		`video_url`=#{videoUrl},
		`describe`=#{describe}
		<where>
			<if test="id!=null">
				#{id}
			</if>
		</where>
	</update>


	<update id="deleteObject">
		update video
		set
		status=1
		<where>
			<if test="id!=null">
				#{id}
			</if>
		<!-- 批量删除 -->
		<if test="ids!=null">
				<foreach collection="ids" item="item">
					#{ids}
				</foreach>
			</if>
		</where>
		
	</update>




</mapper>